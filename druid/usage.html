<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/druid/usage.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.stackable.tech">Stackable Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="druid" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Stackable Operator for Apache Druid</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="building.html">Building the Operator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="configuration.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache Druid</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../home/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../home/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hbase/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hbase/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hdfs/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hdfs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hive/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hive/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../kafka/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../kafka/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../nifi/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../nifi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../spark/index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../spark/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../superset/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../superset/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../zookeeper/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../zookeeper/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../monitoring/index.html">Stackable Operator for Monitoring and Metrics</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../opa/index.html">Stackable Operator for OpenPolicyAgent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../opa/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../regorule/index.html">Stackable Operator for OpenPolicyAgent Rego rules</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../regorule/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../trino/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../trino/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache Druid</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/druid-operator/edit/main/docs/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Druid requires a Zookeeper to run, as well as a database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_prerequisites"><a class="anchor" href="#_setup_prerequisites"></a>Setup Prerequisites</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zookeeper_operator"><a class="anchor" href="#_zookeeper_operator"></a>Zookeeper operator</h3>
<div class="paragraph">
<p>Please refer to the <a href="https://github.com/stackabletech/zookeeper-operator">Zookeeper</a> operator and <a href="https://docs.stackable.tech/zookeeper/index.html">docs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sql_database"><a class="anchor" href="#_sql_database"></a>SQL Database</h3>
<div class="paragraph">
<p>Druid requires a MySQL or Postgres database.</p>
</div>
<div class="paragraph">
<p>For testing purposes, you can spin up a PostgreSQL database with the bitnami PostgreSQL helm chart.  Add the bitnami repository:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>helm repo add bitnami https://charts.bitnami.com/bitnami</pre>
</div>
</div>
<div class="paragraph">
<p>And set up the Postgres database:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>helm install druid bitnami/postgresql \
--set postgresqlUsername=druid \
--set postgresqlPassword=druid \
--set postgresqlDatabase=druid</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_a_druid_cluster"><a class="anchor" href="#_creating_a_druid_cluster"></a>Creating a Druid Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the prerequisites fulfilled, the CRD for this operator must be created:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl apply -f /etc/stackable/druid-operator/crd</pre>
</div>
</div>
<div class="paragraph">
<p>Then a cluster can be deployed using the example below. Make sure you have <strong>exactly one node</strong> labeled with <code>nodeType=druid-data</code> as used in the deep storage selector. Having more than one data node is not supported when using local storage.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: druid.stackable.tech/v1alpha1
kind: DruidCluster
metadata:
  name: simple
spec:
  version: 0.22.0
  zookeeperReference: simple-zk
  metadataStorageDatabase:
    dbType: postgresql
    connString: jdbc:postgresql://druid-postgresql/druid
    host: druid-postgresql    # this is the name of the Postgres service
    port: 5432
    user: druid
    password: druid
  deepStorage:
    storageType: local
    dataNodeSelector:
      nodeType: druid-data
    storageDirectory: /path/to/druidDeepStorage
  brokers:
    roleGroups:
      default:
        config:
          plaintextPort: 8082
          metricsPort: 9090
        replicas: 1
  coordinators:
    roleGroups:
      default:
        config:
          plaintextPort: 8081
          metricsPort: 9090
        replicas: 1
  historicals:
    roleGroups:
      default:
        config:
          plaintextPort: 8083
          metricsPort: 9090
        replicas: 1
  middleManagers:
    roleGroups:
      default:
        config:
          plaintextPort: 8091
          metricsPort: 9095
        replicas: 1
  routers:
    roleGroups:
      default:
        config:
          plaintextPort: 8888
          metricsPort: 9195
        replicas: 1</pre>
</div>
</div>
<div class="paragraph">
<p>The Router is hosting the web UI, a <code>NodePort</code> service is created by the operator to access the web UI. Connect to the <code>simple-router</code> <code>NodePort</code> service and follow the <a href="https://druid.apache.org/docs/latest/tutorials/index.html#step-4-load-data">druid documentation</a> on how to load and query sample data.</p>
</div>
<div class="paragraph">
<p>For monitoring purposes, Prometheus metrics are exposed on <code>metricsPort</code>. Similarly to the web UI above, you need to expose the corresponding port for the group you want to monitor.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_s3"><a class="anchor" href="#_using_s3"></a>Using S3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Druid can use S3 as a backend for deep storage, as well as a data source to ingest data from.</p>
</div>
<div class="paragraph">
<p>To use S3, add a section like this to you cluster <code>spec</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>s3:
  endpoint: s3-de-central.profitbricks.com
  credentialsSecret: s3-credentials</pre>
</div>
</div>
<div class="paragraph">
<p>the secret <code>s3-credentials</code> should contain your access key ID and the secret access key:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apiVersion: v1
kind: Secret
metadata:
  name: s3-credentials
stringData:
  accessKeyId: YOURACCESSKEYIDHERE
  secretAccessKey: YOURSECRETACCESSKEYHERE</pre>
</div>
</div>
<div class="paragraph">
<p>This allows to ingest data from accessible buckets already. To configure a bucket and prefix to be used as a deep storage, change the deep storage configuration like so:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>deepStorage:
  storageType: s3
  bucket: druid-deepstorage
  baseKey: storage           # the base key is the prefix to be used; optional</pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
