<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/spark/usage.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.stackable.tech">Stackable Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="spark" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Stackable Operator for Apache Spark</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="building.html">Building the Operator</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache Spark</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../agent/index.html">Stackable Agent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../agent/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../home/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../home/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hdfs/index.html">Stackable Operator for Apache Hadoop HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hdfs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../kafka/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../kafka/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../nifi/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../nifi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../zookeeper/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../zookeeper/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../opa/index.html">Stackable Operator for OpenPolicyAgent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../opa/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../regorule/index.html">Stackable Operator for OpenPolicyAgent Rego rules</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../regorule/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache Spark</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/spark-operator/edit/main/docs/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The cluster can be configured via a YAML file.
Each role (Master, Worker, History-Server) can have multiple instances within multiple role groups.
Multiple instances in the same selector may lead to port duplicates which results in the affected node
to increase the port one by one (if max_port_retries is not set to 0). Keep that in mind when, for example running multiple masters without specified ports on the same node.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apiVersion: spark.stackable.tech/v1
kind: SparkCluster
metadata:
  name: simple
spec:
  version: "3.0.1"
  masters:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/arch: stackable-linux
        replicas: 1
        config:
          masterPort: 7078
          masterWebUiPort: 8081
  workers:
    roleGroups:
      1core1g:
        selector:
          matchLabels:
            kubernetes.io/arch: stackable-linux
        replicas: 2
        config:
          cores: 1
          memory: "1g"
          workerPort: 3031
          workerWebUiPort: 8083
  historyServers:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/arch: stackable-linux
        replicas: 1
        config:
          historyWebUiPort: 18081</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_structure"><a class="anchor" href="#_structure"></a>Structure</h3>
<div class="paragraph">
<p>There are three levels of configuration:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains configuration that is shared within the whole cluster. For example the spark version, secrets, encryption or logging options.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This configuration is shared for all nodes of a certain type (Master, Worker, History-Server)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role Group properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Options provided in the role group are limited to one specific role and role group.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_common_properties"><a class="anchor" href="#_common_properties"></a>Common properties</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Related Spark properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The spark version used in the format: x.y.z</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logDir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log folder for spark applications (must created by user)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark.history.fs.logDirectory=logDir, spark.eventLog.enabled=true, spark.eventLog.dir=logDir;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A secret shared between nodes and required to submit applications via spark-submit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark.authenticate=true, spark.authenticate.secret=secret;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxPortRetries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of retries when binding to a port before giving up. When a port is given a specific value (non 0), each subsequent retry will increment the port used in the previous attempt by 1 before retrying. This essentially allows it to try a range of ports from the start port specified to port + maxRetries.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark.port.maxRetries</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_role_properties"><a class="anchor" href="#_role_properties"></a>Role properties</h3>
<div class="paragraph">
<p>T.b.d.</p>
</div>
</div>
<div class="sect2">
<h3 id="_role_group_properties"><a class="anchor" href="#_role_group_properties"></a>Role Group properties</h3>
<div class="sect3">
<h4 id="_master"><a class="anchor" href="#_master"></a>Master</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Related Spark properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">masterPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start the master on a different port (default: 7077).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_MASTER_PORT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">masterWebUiPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the master web UI (default: 8080).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_MASTER_WEBUI_PORT</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_worker"><a class="anchor" href="#_worker"></a>Worker</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Related Spark properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start the Spark worker on a specific port (default: random).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_WORKER_PORT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerWebUiPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port for the worker web UI (default: 8081).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_WORKER_WEBUI_PORT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of cores to allow Spark jobs to use on the machine (default: all available cores).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_WORKER_CORES</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of memory to allow Spark jobs to use on the machine, e.g. 1000M, 2G (default: total memory minus 1 GB).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARK_WORKER_MEMORY</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_history_server"><a class="anchor" href="#_history_server"></a>History Server</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Related Spark properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storePath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A local directory where to cache application data. If set, the history server will store application data on disk instead of keeping it in memory. The data written to disk will be re-used in the event of a history server restart.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark.history.store.path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">historyUiPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to which the web interface of the history server binds (default: 18080).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spark.history.ui.port</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
