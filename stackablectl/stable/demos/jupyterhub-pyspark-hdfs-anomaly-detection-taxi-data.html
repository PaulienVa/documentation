<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data :: Stackable Documentation</title>
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script type="text/javascript"> var tCPrivacyTagManager = "gtm"; </script>
    <script>
        var consent = document.createElement("script");
        if(window.location.pathname.indexOf("/en/") > -1){
            // Default is EN Cookie Banner if /en/ in path
            consent.src = "https://cdn.trustcommander.net/privacy/4616/privacy_v2_27.js";
        } else {
            // Default is DE Cookie Banner
            consent.src = "https://cdn.trustcommander.net/privacy/4616/privacy_v2_9.js";
        }
        consent.type = "text/javascript";
        document.head.appendChild(consent);
    </script>
    <!-- Matomo consent with trustcommander -->
    <script type="text/tc_privacy" data-category="2">
    console.log('consent provided for Matomo')
    <!-- Matomo -->
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setCookieDomain", "*.stackable.tech"]);
    _paq.push(["setDomains", ["*.stackable.tech"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="https://stackable.matomo.cloud/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src='//cdn.matomo.cloud/stackable.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
    <!-- End Matomo Code -->
    <script>var uiRootPath = '../../../_'</script>
    <link rel="icon" href="../../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.tech/en/"><img src="../../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="/home/stable/index.html">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search...">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.tech/en/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
<a class="navbar-sub-item" href="../../../home/stable/index.html">Home</a>
<a class="navbar-sub-item" href="../../../home/stable/getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../../../home/stable/concepts/index.html">Concepts</a>
<a class="navbar-sub-item" href="../../../home/stable/tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<a class="navbar-sub-item" href="../index.html">stackablectl</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
        <a class="drop-down-item" href="../../../home/stable/operators/index.html">Overview</a>
        <a class="drop-down-item" href="../../../airflow/stable/index.html">Apache Airflow</a>
        <a class="drop-down-item" href="../../../druid/stable/index.html">Apache Druid</a>
        <a class="drop-down-item" href="../../../hbase/stable/index.html">Apache HBase</a>
        <a class="drop-down-item" href="../../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
        <a class="drop-down-item" href="../../../hive/stable/index.html">Apache Hive</a>
        <a class="drop-down-item" href="../../../kafka/stable/index.html">Apache Kafka</a>
        <a class="drop-down-item" href="../../../nifi/stable/index.html">Apache NiFi</a>
        <a class="drop-down-item" href="../../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
        <a class="drop-down-item" href="../../../superset/stable/index.html">Apache Superset</a>
        <a class="drop-down-item" href="../../../trino/stable/index.html">Trino</a>
        <a class="drop-down-item" href="../../../zookeeper/stable/index.html">Apache ZooKeeper</a>
        <a class="drop-down-item" href="../../../opa/stable/index.html">OpenPolicyAgent</a>
        <a class="drop-down-item" href="../../../commons-operator/stable/index.html">Commons</a>
        <a class="drop-down-item" href="../../../secret-operator/stable/index.html">Secret</a>
        <a class="drop-down-item" href="../../../listener-operator/stable/index.html">Listener</a>
    </div>
</div>
<a class="navbar-sub-item" href="../../../home/stable/contributor/index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="stackablectl" data-version="nightly">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <div class="title-wrapper">
      <h3 class="title"><a href="../index.html">stackablectl</a></h3>
    </div>
    <ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installation.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quickstart.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Commands</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/demo.html">Demo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/operator.html">Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/release.html">Release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/services.html">Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../commands/stack.html">Stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Demos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="airflow-scheduled-job.html">airflow-scheduled-job</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="data-lakehouse-iceberg-trino-spark.html">data-lakehouse-iceberg-trino-spark</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hbase-hdfs-load-cycling-data.html">hbase-hdfs-cycling-data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data.html">jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="logging.html">logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nifi-kafka-druid-earthquake-data.html">nifi-kafka-druid-earthquake-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nifi-kafka-druid-water-level-data.html">nifi-kafka-druid-water-level-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-k8s-anomaly-detection-taxi-data.html">spark-k8s-anomaly-detection-taxi-data</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="trino-iceberg.html">trino-iceberg</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="trino-taxi-data.html">trino-taxi-data</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../customization/index.html">Customization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customization/add_demo.html">Add a demo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customization/add_stack.html">Add a stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customization/add_release.html">Add a release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customization/working_with_feature_branches.html">Working with feature branches</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">stackablectl</span>
    <span class="version">nightly</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../commons-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../commons-operator/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../commons-operator/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../commons-operator/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../commons-operator/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../home/stable/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../home/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../home/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../home/22.11/index.html">22.11</a>
        </li>
        <li class="version">
          <a href="../../../home/22.09/index.html">22.09</a>
        </li>
        <li class="version">
          <a href="../../../home/22.06/index.html">22.06</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../listener-operator/stable/index.html">Stackable Listener Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../listener-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../listener-operator/stable/index.html">23.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../airflow/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../airflow/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../druid/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../druid/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.2/index.html">0.2</a>
        </li>
        <li class="version">
          <a href="../../../druid/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hbase/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hbase/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../hbase/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../hbase/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../hbase/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hdfs/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hdfs/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../hdfs/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../hdfs/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../hdfs/0.4/index.html">0.4</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../hive/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../hive/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../hive/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../hive/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../hive/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../kafka/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../kafka/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../kafka/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../kafka/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../kafka/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../nifi/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../nifi/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../nifi/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../nifi/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../nifi/0.6/index.html">0.6</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../spark-k8s/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../spark-k8s/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.3/index.html">0.3</a>
        </li>
        <li class="version">
          <a href="../../../spark-k8s/0.2/index.html">0.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../superset/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../superset/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../superset/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../superset/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../zookeeper/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../zookeeper/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../zookeeper/0.12/index.html">0.12</a>
        </li>
        <li class="version">
          <a href="../../../zookeeper/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../zookeeper/0.10/index.html">0.10</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../opa/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../opa/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../opa/0.11/index.html">0.11</a>
        </li>
        <li class="version">
          <a href="../../../opa/0.10/index.html">0.10</a>
        </li>
        <li class="version">
          <a href="../../../opa/0.9/index.html">0.9</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../trino/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../trino/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.8/index.html">0.8</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.7/index.html">0.7</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.5/index.html">0.5</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.4/index.html">0.4</a>
        </li>
        <li class="version">
          <a href="../../../trino/0.3/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version">
          <a href="../../../secret-operator/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../../secret-operator/stable/index.html">23.1</a>
        </li>
        <li class="version">
          <a href="../../../secret-operator/0.6/index.html">0.6</a>
        </li>
        <li class="version">
          <a href="../../../secret-operator/0.5/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">stackablectl</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../home/stable/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">stackablectl</a></li>
    <li><a href="index.html">Demos</a></li>
    <li><a href="jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data.html">jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/stackablectl/edit/main/docs/modules/ROOT/pages/demos/jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This demo showcases the integration between <a href="https://jupyter.org">Jupyter</a> and <a href="https://hadoop.apache.org/">Apache Hadoop</a> deployed on the Stackable Data Platform (SDP) Kubernetes cluster. <a href="https://jupyterlab.readthedocs.io/en/stable/">JupyterLab</a> is deployed using the <a href="https://github.com/jupyterhub/zero-to-jupyterhub-k8s">pyspark-notebook stack</a> provided by the Jupyter community. The SDP makes this integration easy by publishing a discovery <code>ConfigMap</code> for the HDFS cluster. This <code>ConfigMap</code> is then mounted in all <code>Pods`</code> running <a href="https://spark.apache.org/docs/latest/api/python/getting_started/index.html">PySpark</a> notebooks so that these have access to HDFS data. For this demo, the HDFS cluster is provisioned with a small sample of the <a href="https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page">NYC taxi trip dataset</a> which is analyzed with a notebook that is provisioned automatically in the JupyterLab interface .</p>
</div>
<div class="paragraph">
<p>This demo can be installed on most cloud managed Kubernetes clusters as well as on premise or on a reasonably provisioned laptop. Install this demo on an existing Kubernetes cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">stackablectl demo install jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some container images used by this demo are quite large and some steps may take several minutes to complete. If you install this demo locally, on a developer laptop for example, this can lead to timeouts during the installation. If this happens, it&#8217;s safe to rerun the <code>stackablectl</code> command from above.</p>
</div>
<div class="paragraph">
<p>For more details on how to install Stackable demos see the <a href="../commands/demo.html#_install_demo" class="xref page">documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aim_context"><a class="anchor" href="#_aim_context"></a>Aim / Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This demo does not use the Stackable spark-k8s-operator but rather delegates the creation of executor pods to JupyterHub. The intention is to demonstrate how to interact with SDP components when designing and testing Spark jobs: the resulting script and Spark job definition can then be transferred for use with a Stackable <code>SparkApplication</code> resource. When logging in to JupyterHub (described below), a pod will be created with the username as a suffix e.g. <code>jupyter-admin</code>. This runs a container that hosts a Jupyter notebook with Spark, Java and Python pre-installed. When the user creates a <code>SparkSession</code>, temporary spark executors are created that are persisted until the notebook kernel is shut down or re-started. The notebook can thus be used as a sandbox for writing, testing and benchmarking Spark jobs before they are moved into production.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This demo will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the required Stackable Data Platform operators</p>
</li>
<li>
<p>Spin up the following data products</p>
<div class="ulist">
<ul>
<li>
<p><strong>JupyterHub</strong>: A multi-user server for Jupyter notebooks</p>
</li>
<li>
<p><strong>Apache HDFS</strong>: A distributed file system used to store the taxi dataset</p>
</li>
</ul>
</div>
</li>
<li>
<p>Download a sample of the NY taxi dataset into HDFS</p>
</li>
<li>
<p>Install Jupyter notebook</p>
</li>
<li>
<p>Train an anomaly detection model using PySpark on the data available in HDFS</p>
</li>
<li>
<p>Perform some predictions and visualize anomalies</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hdfs"><a class="anchor" href="#_hdfs"></a>HDFS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Stackable Operator for Apache HDFS will spin up a HDFS cluster in order to store the taxi dataset in <a href="https://parquet.apache.org/">Apache Parquet</a> format. This dataset will be read and processed via PySpark.</p>
</div>
<div class="paragraph">
<p>Before trying out the notebook example in Jupyter, check if the taxi data was loaded to HDFS successfully:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl exec -c namenode -it hdfs-namenode-default-0 -- /bin/bash -c "./bin/hdfs dfs -ls /ny-taxi-data/raw"
Found 1 items
-rw-r--r--   3 stackable supergroup  314689382 2022-11-23 15:01 /ny-taxi-data/raw/fhvhv_tripdata_2020-09.parquet</code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be one parquet file containing taxi trip data from September 2020.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jupyterhub"><a class="anchor" href="#_jupyterhub"></a>JupyterHub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Have a look at the available Pods before logging in (operator pods are left out for clarity, you will see more Pods):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl get pods
NAME                                             READY   STATUS      RESTARTS   AGE
continuous-image-puller-87dzk                    1/1     Running     0          29m
continuous-image-puller-8qq7m                    1/1     Running     0          29m
continuous-image-puller-9xbss                    1/1     Running     0          29m
hdfs-datanode-default-0                          1/1     Running     0          29m
hdfs-journalnode-default-0                       1/1     Running     0          29m
hdfs-namenode-default-0                          2/2     Running     0          29m
hdfs-namenode-default-1                          2/2     Running     0          28m
hub-66c6798b9c-q877t                             1/1     Running     0          29m
load-test-data-wsqpk                             0/1     Completed   0          25m
proxy-65955f56cf-tf4ns                           1/1     Running     0          29m
user-scheduler-8d888c6d4-jb4mm                   1/1     Running     0          29m
user-scheduler-8d888c6d4-qbqkq                   1/1     Running     0          29m</code></pre>
</div>
</div>
<div class="paragraph">
<p>JupyterHub will create a Pod for each active user. In order to reach the JupyterHub web interface, create a port-forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl port-forward service/proxy-public 8080:http</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now access the JupyterHub web interface via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http://localhost:8080</pre>
</div>
</div>
<div class="paragraph">
<p>You should see the JupyterHub login page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data/jupyter_hub_login.png" alt="jupyter hub login">
</div>
</div>
<div class="paragraph">
<p>Log in with username <code>admin</code> and password <code>adminadmin</code>.</p>
</div>
<div class="paragraph">
<p>There should appear a new pod called <code>jupyter-admin</code> (operator pods are left out for clarity, you will see more Pods):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kubectl get pods
NAME                                             READY   STATUS      RESTARTS   AGE
continuous-image-puller-87dzk                    1/1     Running     0          29m
continuous-image-puller-8qq7m                    1/1     Running     0          29m
continuous-image-puller-9xbss                    1/1     Running     0          29m
hdfs-datanode-default-0                          1/1     Running     0          29m
hdfs-journalnode-default-0                       1/1     Running     0          29m
hdfs-namenode-default-0                          2/2     Running     0          29m
hdfs-namenode-default-1                          2/2     Running     0          28m
hub-66c6798b9c-q877t                             1/1     Running     0          29m
jupyter-admin                                    1/1     Running     0          20m
load-test-data-wsqpk                             0/1     Completed   0          25m
proxy-65955f56cf-tf4ns                           1/1     Running     0          29m
user-scheduler-8d888c6d4-jb4mm                   1/1     Running     0          29m
user-scheduler-8d888c6d4-qbqkq                   1/1     Running     0          29m</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should arrive at your workspace:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data/jupyter_hub_workspace.png" alt="jupyter hub workspace">
</div>
</div>
<div class="paragraph">
<p>Now you can click on the <code>notebooks</code> folder on the left and open the contained file and run it. Click on the double arrow to execute the Python scripts. You can inspect the <code>hdfs</code> folder as well where the <code>core-site.xml</code> and <code>hdfs-site.xml</code> from the discovery <code>ConfigMap</code> of the HDFS cluster are located.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data/jupyter_hub_run_notebook.png" alt="jupyter hub run notebook">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The image defined for the spark job must contain all dependencies needed for that job to run. For pyspark jobs, this will mean that python libraries either need to be baked into the image itself (this demo contains a Dockerfile that was used to generate a image containing scikit-learn, pandas and their dependencies), or <a href="https://spark.apache.org/docs/latest/api/python/user_guide/python_packaging.html">packaged some other way</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_model_details"><a class="anchor" href="#_model_details"></a>Model details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The job uses an implementation of the Isolation Forest <a href="https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf">algorithm</a> provided by the scikit-learn <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html">library</a>: the model is trained and then invoked by a user-defined function (see <a href="https://towardsdatascience.com/isolation-forest-and-spark-b88ade6c63ff">this article</a> for how to call the sklearn library with a pyspark UDF), all of which is run using the Spark executors spun up in the current <code>SparkSession</code>. This type of model attempts to isolate each data point by continually partitioning the data. Data closely packed together will require more partitions to separate data points, whereas any outliers will require less: the number of required partitions for a particular data point is thus inversely proportional to the anomaly "score".</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_visualization"><a class="anchor" href="#_visualization"></a>Visualization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The notebook shows how to plot the outliers against a particular metric (e.g. "number of rides"):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data/jupyter_hub_graph.png" alt="jupyter hub graph">
</div>
</div>
<div class="paragraph">
<p>However, this is mainly for convenience - the anomaly score is derived from the <strong><em>entire</em></strong> feature space i.e. it takes all dimensions (or features/columns) into account when scoring data. This means that not only are the results difficult to visualize (how can multidimensional data be represented in only 3-D dimensional space?), but that a root cause analysis has to be a separate process. It would be tempting to look at just one metric and assume causal affects, but the model "sees" all features as a set of numerical values and derives patterns accordingly.</p>
</div>
<div class="paragraph">
<p>We can tackle the first of these issues by collapsing - or projecting - our data down into a manageable number of dimensions that can be plotted: once the script has finished successfully, plots should be displayed on the bottom that show the same data in 2D and 3D representation. The 3D plot should look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/demo-jupyterhub-pyspark-hdfs-anomaly-detection-taxi-data/jupyter_hub_3d_isolation_forest.png" alt="jupyter hub 3d isolation forest">
</div>
</div>
<div class="paragraph">
<p>It is clear that the model has detected outliers even though that would not have been immediately apparent from the time-series representation alone.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-container">
      <!-- link columns -->
      <div class="footer-info">
        <div class="footer-info-item-large">
          <img src="../../../_/img/logo-2-1.png">
          <p>
            your data, your platform
          </p>
        </div>
        <div class="footer-info-item">
          <h2>Company</h2>
          <ul class="footer-link-list">
            <li>
              <a href="https://stackable.tech/en/about-us">About Us</a>
            </li>
            <li>
              <a href="https://stackable.tech/en/blog">Blog</a>
            </li>
            <li>
              <a href="https://jobs.stackable.de/" target="_blank">Jobs</a>
            </li>
          </ul>
        </div>
        <div class="footer-info-item">
          <h2>Support</h2>
          <ul class="footer-link-list">
            <li>
              <a href="https://stackable.tech/en/contact">Contact Us</a>
            </li>
            <li>
              <a href="https://stackable.tech/en/imprint">Imprint</a>
            </li>
            <li>
              <a href="https://stackable.tech/en/data-protection">Data Protection</a>
            </li>
          </ul>
        </div>
        <div class="footer-info-item">
          <h2>Get in touch</h2>
          <ul class="footer-link-list">
            <li>
              <a href="mailto:info@stackable.de">info@stackable.de</a>
            </li>
            <li>
              <a href="tel:+4941039263100">+49 4103 926 3100</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="footer-seperator"></div>
      <!-- social links -->
      <div class="c-and-socials">
        <div>© 2022 Stackable.</div>
        <div class="social-icons-container">
          <a class="social-icon" href="https://www.xing.com/pages/stackable" target="_blank">
            <i class="fab fa-xing"></i>
          </a>
          <a class="social-icon" href="https://www.linkedin.com/company/stackabletech/" target="_blank">
            <i class="fab fa-linkedin"></i>
          </a>
          <a class="social-icon" href="https://github.com/stackabletech" target="_blank">
            <i class="fab fa-github"></i>
          </a>
          <a class="social-icon" href="https://twitter.com/stackabletech" target="_blank">
            <i class="fab fa-twitter"></i>
          </a>
        </div>
      </div>
      <!-- copyright notice -->
      <p>
        Apache, Apache Kafka®, Kafka, and the Kafka logo, Apache Druid, Druid, and the Druid logo,
        Apache ZooKeeper™, ZooKeeper, and the Druid logo, Apache Hive™, Hive, and the Hive logo,
        Apache Spark™, Spark, and the Spark logo, Apache Airflow, Airflow, and the Airflow logo,
        Apache HBase®, HBase, and the HBase logo, Apache NiFi, NiFi, and the NiFi logo, Apache
        Superset, Superset, the Superset logo, Apache Hadoop® HDFS, Apache Hadoop, Hadoop and the
        Hadoop logo, Apache Phoenix™, Phoenix and the Phoenix-Logo, Apache Iceberg, Iceberg and the
        Iceberg-Logo are either registered trademarks or trademarks of the Apache Software Foundation
        in the United States and/or other countries. Open Policy Agent (OPA) is a Cloud Native
        Computing Foundation graduated project. Licensed under the Apache License, Version 2.0. Trino
        is open source software licensed under the Apache License 2.0 and supported by the Trino
        Software Foundation. MinIO is a [“registered”, if applicable] trademark of the MinIO
        Corporation. All other products or name brands are trademarks of their respective holders.
        All product and service names used in this website are for identification purposes only and
        do not imply endorsement.
      </p>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
