<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stackable Documentation :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/home/index.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.stackable.tech">Stackable Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="home" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Stackable Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="paths.html">Default Paths</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">ADRs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Current</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR001-choose_project_language.html">Use English as Documentation Language</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR002-choose_repository_structure.html">Use Multiple Repositories instead of one Large Repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR003-choose_review_mechanism.html">Use RTC as Review Mechanism for Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR004-choose_agent_programming_language.html">Use Rust as programming language for the agent</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR005-systemd_unit_file_location.html">Decide on handling and location of systemd unit files</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR007-defined_reuse_of_k8s.html">Decide if Kubernetes Components Are to be Reused for Stackable</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR008-decide_reuse_of_operators.html">Allow Reuse of Existing Kubernetes Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR009-selector_support.html">ADR009: Assigning Services to Nodes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR010-command_pattern.html">ADR010: Expressing one-shot commands in a Kubernetes-native way</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/ADR011-directory_structure.html">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deprecated</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/deprecated/ADR006-choose_orchestrator_storage_backend.html">Use xxx as storage backend for the orchestrator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Drafts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="adr/drafts/ADRx-choose_authorization_engine.html">Choose Authorization Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Maturity Levels</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/operators/operator_maturity_levels.html">Operator Maturity Levels</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/operators/apache_kafka.html">Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/operators/apache_nifi.html">Apache NiFi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/operators/apache_spark.html">Apache Spark</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/operators/apache_zookeeper.html">Apache ZooKeeper</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/platform_maturity_levels.html">Platform Maturity Levels</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/ML1.html">Maturity Level 1</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/ML2.html">Maturity Level 2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/ML3.html">Maturity Level 3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/ML4.html">Maturity Level 4</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="maturity_levels/platform/ML5.html">Maturity Level 5</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../agent/index.html">Stackable Agent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../agent/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hdfs/index.html">Stackable Operator for Apache Hadoop HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hdfs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../kafka/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../kafka/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../nifi/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../nifi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../spark/index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../spark/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../zookeeper/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../zookeeper/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../opa/index.html">Stackable Operator for OpenPolicyAgent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../opa/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../regorule/index.html">Stackable Operator for OpenPolicyAgent Rego rules</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../regorule/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link is-current"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Documentation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/documentation/edit/main/modules/ROOT/pages/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Stackable Documentation</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With our Stackable technology we aim to create an orchestration system that allows end users to deploy, scale and manage Big Data infrastructure on any environment, no matter if it&#8217;s a VM or bare metal both in cloud and on-premise.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_goal_of_the_project"><a class="anchor" href="#_goal_of_the_project"></a>Goal of the project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal is to be able to declare full Data Platforms using this concept and go beyond pure low-level applications. This means that we want to be able to deploy a Kafka cluster for example. In the future we would also like to be able to declaratively roll out data, provide proper security configuration out of the box, Kafka topics, HDFS directories, Replication policies, maybe even Spark jobs.</p>
</div>
<div class="paragraph">
<p>We want to build a distribution that includes the “best of breed” of existing Open Source tools, but bundles them in a way so it is easy to deploy a fully working stack of software. Most of the existing tools are “single purpose” tools which often do not play nicely together out-of-the-box.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stackable deploys a server-client architecture where decentralized agents receive commands from the central server to execute.
Generally speaking we make use of the <a href="https://en.wikipedia.org/wiki/Whiteboard_Pattern">whiteboard pattern</a> as communication paradigm.</p>
</div>
<div class="paragraph">
<p>With Kubernetes as a prominent implementation of that architecture, we considered and decided on <a href="https://github.com/stackabletech/documentation/adr/ADR7-defined_reuse_of_k8s.adoc">reusing Kubernetes components</a>.</p>
</div>
<div class="sect2">
<h3 id="_assumption"><a class="anchor" href="#_assumption"></a>Assumption</h3>
<div class="paragraph">
<p>The infrastructure (like a VM server) should be already available and contains a SSH Login runing on a Linux OS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_components"><a class="anchor" href="#_components"></a>Components</h3>
<div class="paragraph">
<p>The following components will set up our orchestration system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes API-Server</p>
</li>
<li>
<p>Agent(s): one per VM</p>
</li>
<li>
<p>Operators: one per application/Big Data Product</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components_and_their_functionality"><a class="anchor" href="#_components_and_their_functionality"></a>Components and their functionality</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_api_server_orchestrator"><a class="anchor" href="#_api_server_orchestrator"></a>API-Server (Orchestrator)</h3>
<div class="paragraph">
<p>At the moment we use the standard Kubernetes API-Server and stay API-compatible with Kubernetes. In the future we might implement our own Orchestrator component if needed.
The API-Server acts as a centralized frontend for the clusters shared storage. It is the component through which all other components (i.e. Agents, Kubelet, Operators, &#8230;&#8203;) communicate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operators"><a class="anchor" href="#_operators"></a>Operator(s)</h3>
<div class="paragraph">
<p>For each application/Big Data Product there is exactly one special Operator defined.
They watch for changes in their managed resources in the API-Server.
This Operator is the expert of the application logic, how to roll out and update the Big Data Product (e.g. Kafka with the <a href="https://github.com/stackabletech/kafka-operator">kafka-operator</a> and <a href="https://github.com/stackabletech/zookeeper-operator">zookeeper-operator</a>).
An Operator should implement and encompass all the knowledge a human operator would need when operating the service in question.
To ease up operator development we created an <a href="https://github.com/stackabletech/operator-rs">operator-framework</a> to base new operators on, other than implementing the whole workflow/api by oneself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_agents"><a class="anchor" href="#_agents"></a>Agent(s)</h3>
<div class="paragraph">
<p>The <a href="https://github.com/stackabletech/agent">Agent(s)</a> do not know anything about concrete Big Data products, they only execute work instructions, provided by the Operator(s). Every system dedicated in the Big Data cluster runs a copy of the Agent, registered to the central API-Server, to get informed about updates.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_communication_and_interaction"><a class="anchor" href="#_communication_and_interaction"></a>Communication and interaction</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="_images/interaction-diagram.svg" alt="interaction diagram">
</div>
</div>
<div class="sect2">
<h3 id="_1_client_api_server_orchestrator"><a class="anchor" href="#_1_client_api_server_orchestrator"></a>1. Client &#8594; API-Server (Orchestrator)</h3>
<div class="paragraph">
<p>The client creates a YAML file for the API-Server, which defines the configuration for the Big Data Product (e.g. Kafka). The client then uses the usual Kubernetes tools (e.g. <code>kubectl</code> or any other Kubernetes client).
This means that the whole infrastructure will be described in code (Infrastructure-as-Code) and can be version controlled.</p>
</div>
</div>
<div class="sect2">
<h3 id="_2_api_server_orchestrator_operators"><a class="anchor" href="#_2_api_server_orchestrator_operators"></a>2. API-Server (Orchestrator) &#8594; Operator(s)</h3>
<div class="paragraph">
<p>The API-Server receives the YAML file from the Client, identifies the appropriate Operator(s) (e.g. Kafka Operator) and notifies about the file changes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_3_operators_api_server_orchestrator"><a class="anchor" href="#_3_operators_api_server_orchestrator"></a>3. Operator(s) &#8594; API-Server (Orchestrator)</h3>
<div class="paragraph">
<p>The appropriate Operator(s) (e.g. Kafka Operator) will translate the abstract description into detailed actions for the Agent(s).</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_agents_api_server_orchestrator"><a class="anchor" href="#_4_agents_api_server_orchestrator"></a>4. Agent(s) &#8594; API-Server (Orchestrator)</h3>
<div class="paragraph">
<p>In the meantime each Agent, running on its own VM, is listening for updates, which belongs to its VM. If there is an update for the appropriate VM, then the Agent of this VM is going to obtain the configuration and act accordingly. (e.g. download an artifact, update a configuration or start a process locally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_agents_big_data_product_kafka"><a class="anchor" href="#_5_agents_big_data_product_kafka"></a>5. Agent(s) &#8594; Big Data Product (Kafka)</h3>
<div class="paragraph">
<p>Finally, the Agent(s) will provision the Big Data Product (e.g. setting up a Kafka) onto the node of its VM.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_technical_base"><a class="anchor" href="#_technical_base"></a>Technical base</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_api_server_orchestrator_2"><a class="anchor" href="#_api_server_orchestrator_2"></a>API-Server (Orchestrator)</h3>
<div class="paragraph">
<p>The <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">Kubernetes API-Server</a> validates and configures data for the api objects which include pods, services, replicationcontrollers, and others. The API-Server services <strong>REST</strong> operations and provides the frontend to the cluster&#8217;s shared state through which all other components interact.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operators_2"><a class="anchor" href="#_operators_2"></a>Operator(s)</h3>
<div class="paragraph">
<p>The Operator(s), which can run on the same server as the API-Server or on their own server, can be written in any programming language. We are using <strong>Rust</strong> to implement our Operators.</p>
</div>
</div>
<div class="sect2">
<h3 id="_agents_2"><a class="anchor" href="#_agents_2"></a>Agent(s)</h3>
<div class="paragraph">
<p>We have chosen <strong>Rust</strong> as a programming language for the implementation of the Agent. This tool will manage the installation on the VM.
Rust is a Programming language, which is focused on safety. It provides memory safety without a garbage collector.</p>
</div>
<div class="paragraph">
<p><strong>Decision Drivers:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The ability to deploy the agent as one binary with no external dependencies</p>
</li>
<li>
<p>Availability of well-supported libraries for necessary operations</p>
</li>
<li>
<p>File IO</p>
</li>
<li>
<p>Network IO</p>
</li>
<li>
<p>systemd</p>
</li>
<li>
<p>IDE support</p>
</li>
<li>
<p>Debugging options</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Intrigued?
Want to try it out?</p>
</div>
<div class="paragraph">
<p>The following paragraphs will guide you through setting up all necessary components to create a working Stackable Platform which you can then use to deploy services.</p>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h3>
<div class="paragraph">
<p>In order to provide a working platform, we will perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Kubernetes</p>
</li>
<li>
<p>Add Nodes to Kubernetes</p>
</li>
<li>
<p>Install operators for products</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can run the entire platform on your laptop or a single virtual machine, but it is highly recommended to use several machines for the following steps.
The following terms will be used throughout the remainder of this guide:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Orchestrator</strong>: A single server which is used to run components that are needed only once</p>
</li>
<li>
<p><strong>Worker</strong>: One or more servers that are intended to run the actual workloads (Apache Hadoop, Apache Kafka, &#8230;&#8203;) later on</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Going forward, we will assume that you are installing this on several machines, but most commands should work the same in a single-machine scenario.
We will alert you if something needs to be done differently when running everything on the same machine.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/quickstart_architecture.png" alt="quickstart architecture">
</div>
<div class="title">Figure 1. By the end of this guide, the environment that you have set up will look like this</div>
</div>
</div>
<div class="sect2">
<h3 id="_prepare_nodes"><a class="anchor" href="#_prepare_nodes"></a>Prepare Nodes</h3>
<div class="paragraph">
<p>Perform the following steps on both the orchestrator and worker nodes.</p>
</div>
<div class="sect3">
<h4 id="_install_stackable_repository"><a class="anchor" href="#_install_stackable_repository"></a>Install Stackable Repository</h4>
<div class="sect4">
<h5 id="_debianubuntu"><a class="anchor" href="#_debianubuntu"></a>Debian/Ubuntu</h5>
<div class="paragraph">
<p>In order to be able to verify that the releases have not been tampered with, you&#8217;ll need to verify and install the PGP key we use to sign these releases.
A prerequisite for these operations is, that an implementation of PGP needs to be installed, if this is not yet the case you can do so by running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apt-get install gnupg</pre>
</div>
</div>
<div class="paragraph">
<p>The key is available on the Ubuntu keyserver under the id <em>16dd12f5c7a6d76a</em> and can be added to your apt keychain with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 16dd12f5c7a6d76a</pre>
</div>
</div>
<div class="paragraph">
<p>To enable the actual repository, put the following content into <code>/etc/apt/sources.list.d/stackable.list</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>deb https://repo.stackable.tech/repository/deb-dev buster main</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_centosrhel"><a class="anchor" href="#_centosrhel"></a>Centos/RHEL</h5>
<div class="paragraph">
<p><strong>coming soon</strong></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_kubernetes"><a class="anchor" href="#_install_kubernetes"></a>Install Kubernetes</h3>
<div class="paragraph">
<p>Usually the installation and configuration of Kubernetes is a full-blown project all of its own, so it might seem a bit weird to find this tucked away in a little section of the quickstart guide like this.
However, the Stackable Platform only uses a very limited subset of the full Kubernetes features, so for our purposes we could actually get away with just running a <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/">kube-apiserver</a> and leaving out the entire rest of the <a href="https://kubernetes.io/docs/concepts/overview/components/">control-plane</a>.
This makes the deployment a lot simpler.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have tested our stack with Kubernetes 1.18 and above
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That being said, Stackable will work with any Kubernetes, please feel free to skip this chapter if you already have a working Kubernetes cluster, or want to use a managed Kubernetes offering like the ones provided by <a href="https://www.ionos.com/enterprise-cloud/managed-kubernetes">IONOS</a>, <a href="https://cloud.google.com/kubernetes-engine">Google</a> or <a href="https://docs.microsoft.com/en-us/azure/aks/">Azure</a>.</p>
</div>
<div class="paragraph">
<p>So far we have only tested the Stackable Agent with the IONOS managed Kubernetes service, we will update the compatibility matrix here as we perform further tests.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kubernetes Service</th>
<th class="tableblock halign-left valign-top">Compatibility</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://www.ionos.com/enterprise-cloud/managed-kubernetes">IONOS Managed Kubernetes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compatible</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://cloud.google.com/kubernetes-engine">Google Kubernetes Engine</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Untested</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.microsoft.com/en-us/azure/aks/">Azure Kubernetes Service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Untested</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://aws.amazon.com/eks">Amazon Elastic Kubernetes Service</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Untested</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are numerous possibilities to go about this, but we will focus on <a href="https://k3s.io/">K3S</a>, a lightweight Kubernetes distribution that is provided by <a href="https://rancher.com/">Rancher</a>.</p>
</div>
<div class="paragraph">
<p>Run the following command on your <em>orchestrator</em> node:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>curl -sfL https://get.k3s.io | sh -</pre>
</div>
</div>
<div class="paragraph">
<p>This will download and install K3S, and configure systemd services to run at startup.
Client tools like <code>kubectl</code> will also be installed and configured correctly to connect to Kubernetes.</p>
</div>
<div class="paragraph">
<p>To check if everything worked as expected you can use kubctl to retrieve the cluster information:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl cluster-info</pre>
</div>
</div>
<div class="paragraph">
<p>See below for an example of an expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Kubernetes control plane is running at https://127.0.0.1:6443
CoreDNS is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</pre>
</div>
</div>
<div class="sect3">
<h4 id="_distribute_kubeconfig"><a class="anchor" href="#_distribute_kubeconfig"></a>Distribute kubeconfig</h4>
<div class="paragraph">
<p>Since our agent registers in Kubernetes very similarly to a regular Kubelet it will need a kubeconfig to know how and where to connect to Kubernetes.
When we installed K3S, it generated a configuration that clients can use in <code>/etc/rancher/k3s/k3s.yaml</code> on the orchestrator server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently the kubeconfig will contain 127.0.0.1 as the api-server IP, you will need to change this to the ip address of your orchestrator server
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This file needs to be put on every node of the cluster - ideally you&#8217;d copy this file to <code>/root/.kube/config</code> which will make all components that run as the root user use this configuration.
Perform this step for the orchestrator also, as the operators will expect to finde a kubeconfig in that place.</p>
</div>
<div class="paragraph">
<p>If you need to be able to connect to other Kubernetes clusters, or do not want to make this the global config (for the root user) for other reasons, then you can choose a different location for this file.</p>
</div>
<div class="paragraph">
<p>Please see below for extra steps that need to be taken to enable this config.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_specify_a_repository"><a class="anchor" href="#_specify_a_repository"></a>Specify a Repository</h3>
<div class="paragraph">
<p>Stackable downloads packages from repositories, which the agents need to know about.
To avoid having to configure these repositories on every agent they are instead specified in Kubernetes and retrieved from there by the agent.</p>
</div>
<div class="paragraph">
<p>In order to allow creating a repository, you&#8217;ll have to create the CRD for repositories in your freshly installed Kubernetes cluster.
The CRD looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: repositories.stable.stackable.de
spec:
  group: stable.stackable.de
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                repo_type:
                  type: string
                properties:
                  type: object
                  additionalProperties:
                    type: string
  scope: Namespaced
  names:
    plural: repositories
    singular: repository
    kind: Repository
    shortNames:
    - repo</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose whatever way is most convenient for you to apply this CRD to your cluster, one possible way is using <code>kubectl</code> from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: repositories.stable.stackable.de
spec:
  group: stable.stackable.de
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                repo_type:
                  type: string
                properties:
                  type: object
                  additionalProperties:
                    type: string
  scope: Namespaced
  names:
    plural: repositories
    singular: repository
    kind: Repository
    shortNames:
    - repo
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can either host your own repository or specify our public repository for convenience.
The specification for our repository is shown below and can be applied with <code>kubectl</code> just like the definition above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: "stable.stackable.de/v1"
kind: Repository
metadata:
  name: stackablepublic
spec:
  repo_type: StackableRepo
  properties:
    url: https://repo.stackable.tech/repository/packages/
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_operators"><a class="anchor" href="#_install_operators"></a>Install Operators</h3>
<div class="paragraph">
<p>Depending on the products you want to manage with the Stackable platform, you need to install our corresponding operators.
They are made available as OS packages as well, the currently available operators are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Product</th>
<th class="tableblock halign-left valign-top">Package Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stackable-kafka-operator-server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Spark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stackable-spark-operator-server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache ZooKeeper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stackable-zookeeper-operator-server</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_rhel"><a class="anchor" href="#_rhel"></a>RHEL</h4>
<div class="paragraph">
<p><strong>coming soon</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_ubuntu"><a class="anchor" href="#_ubuntu"></a>Ubuntu</h4>
<div class="literalblock">
<div class="content">
<pre>apt-get install stackable-spark-operator-server</pre>
</div>
</div>
<div class="paragraph">
<p>To start and enable the services please run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Kafka
systemctl start stackable-kafka-operator-server
systemctl enable stackable-kafka-operator-server

# Spark
systemctl start stackable-spark-operator-server
systemctl enable stackable-spark-operator-server

# ZooKeeper
systemctl start stackable-zookeeper-operator-server
systemctl enable stackable-zookeeper-operator-server</pre>
</div>
</div>
<div class="paragraph">
<p>To check if the services started successfully you can run (example for ZooKeeper):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>systemctl status stackable-zookeeper-operator-server</pre>
</div>
</div>
<div class="paragraph">
<p>This should report the service as being loaded and enabled.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_add_nodes_to_kubernetes"><a class="anchor" href="#_add_nodes_to_kubernetes"></a>Add Nodes to Kubernetes</h3>
<div class="sect3">
<h4 id="_install_agent"><a class="anchor" href="#_install_agent"></a>Install Agent</h4>
<div class="paragraph">
<p>The agent needs to be installed on all servers that should run services and they need to be configured to have access to Kubernetes.</p>
</div>
<div class="paragraph">
<p>Installing the agent can be done from our RPM and deb package repositories, which we enabled when preparing the nodes above.
The packages also install a systemd service to run the agent, this is not enabled or started by default though</p>
</div>
<div class="sect4">
<h5 id="_rhel_2"><a class="anchor" href="#_rhel_2"></a>RHEL</h5>
<div class="literalblock">
<div class="content">
<pre>*coming soon*</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ubuntu_2"><a class="anchor" href="#_ubuntu_2"></a>Ubuntu</h5>
<div class="literalblock">
<div class="content">
<pre>apt-get install stackable-agent</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_the_agent"><a class="anchor" href="#_configuring_the_agent"></a>Configuring the Agent</h4>
<div class="paragraph">
<p>When installing from packages the agent config file is created in '/etc/stackable-agent/agent.conf'.</p>
</div>
<div class="paragraph">
<p>The Agent takes a few configuration options, please refer to <a href="https://github.com/stackabletech/agent#command-line-parameters">the agent documentation</a> for more details.</p>
</div>
<div class="paragraph">
<p>If you have provided a kubeconfig for the root user in <code>/root/.kube/config</code> then the agent will use this, if you decided against a <em>global</em> <code>KUBECONFIG</code> environment variable, you will need to specify where the config should be read from.</p>
</div>
<div class="paragraph">
<p>This can be done by adding a systemd drop-in file that is merged with the package provided unit file.
Put the following content in <code>/usr/lib/systemd/system/stackable-agent.service.d/kubeconfig.conf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Service]
Environment="KUBECONFIG=/path/to/kubeconfig"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starting_the_agent"><a class="anchor" href="#_starting_the_agent"></a>Starting the Agent</h4>
<div class="paragraph">
<p>The agent can be started like any regular systemd service by running</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl start stackable-agent</pre>
</div>
</div>
<div class="paragraph">
<p>To enable it to be started at every boot:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>systemctl enable stackable-agent</pre>
</div>
</div>
<div class="paragraph">
<p>During the first start of the agent, it will perform some bootstrapping tasks, most notably it will generate a keypair and request a signed certificate from Kubernetes.</p>
</div>
<div class="paragraph">
<p>If your Kubernetes is not configured to auto-approve these CSRs, you will need to manually approve that request before the agent can start.</p>
</div>
<div class="paragraph">
<p>You can do this by running <code>kubectl certificate approve &lt;agent-hostname&gt;-tls</code> on the orchestrator server after starting the agent.</p>
</div>
<div class="paragraph">
<p>If your Kubernetes does not offer certificate signing services, you can alternatively also manually generate a keypair and sign a certificate with a proper authority.
These files will then need to be configured in the agent config file.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_health_check"><a class="anchor" href="#_health_check"></a>Health Check</h3>
<div class="paragraph">
<p>After performing the steps outlined above you should have an empty Stackable Platform up and running.
When you run <code>kubectl get nodes</code> on the orchestrator, you should see the objects that all your agents added to indicate their readiness.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architectural_design_decisions"><a class="anchor" href="#_architectural_design_decisions"></a>Architectural Design Decisions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All relevant decisions concerning the architecture are documented as Architectural Design Records in the subfolder <em>adr</em>.</p>
</div>
<div class="paragraph">
<p>Unfinished or not yet approved decisions are stored in the <em>adr/drafts</em> subfolder.
This folder also contains a template that can be used for creating new decision records.</p>
</div>
<div class="paragraph">
<p><strong>Naming Convention</strong><br>
When creating a new record, please use the following guidelines for file naming:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ADR[number]-[name].adoc</pre>
</div>
</div>
<div class="paragraph">
<p>During the draft stage please substitute x for the number.
For the name, please use only lower case letters, number and the underscore.
Ideally start the name with the imperative form of a verb and avoid fillers like <em>of/the/for/&#8230;&#8203;</em></p>
</div>
<div class="paragraph">
<p>Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>choose_project_language</p>
</li>
<li>
<p>choose_repository_structure</p>
</li>
<li>
<p>choose_review_mechanism</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When choosing the next free number after an ADR has been approved, make sure to left pad the number with 0 to reach a length of three digits.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
