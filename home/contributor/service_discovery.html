<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Service Discovery :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/home/contributor/service_discovery.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.de"><img src="../../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="navbar-sub">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.de/en/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav id="navbar-sub" class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="../index.html">Home</a>
<a class="navbar-sub-item" href="../getting_started.html">Getting Started</a>
<a class="navbar-sub-item" href="../tutorials/end-to-end_data_pipeline_example.html">Tutorials</a>
<div class="navbar-sub-item drop-down">
    Operators
    <div class="drop-down-content">
    <a class="drop-down-item" href="../operators/index.html">Overview</a>
    <a class="drop-down-item" href="../../airflow/stable/index.html">Apache Airflow</a>
    <a class="drop-down-item" href="../../druid/stable/index.html">Apache Druid</a>
    <a class="drop-down-item" href="../../hbase/stable/index.html">Apache HBase</a>
    <a class="drop-down-item" href="../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
    <a class="drop-down-item" href="../../hive/stable/index.html">Apache Hive</a>
    <a class="drop-down-item" href="../../kafka/stable/index.html">Apache Kafka</a>
    <a class="drop-down-item" href="../../nifi/stable/index.html">Apache NiFi</a>
    <a class="drop-down-item" href="../../spark/stable/index.html">Apache Spark (standalone)</a>
    <a class="drop-down-item" href="../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
    <a class="drop-down-item" href="../../superset/stable/index.html">Apache Superset</a>
    <a class="drop-down-item" href="../../trino/stable/index.html">Trino</a>
    <a class="drop-down-item" href="../../zookeeper/stable/index.html">Apache ZooKeeper</a>
    <a class="drop-down-item" href="../../opa/stable/index.html">OpenPolicyAgent</a>
    <a class="drop-down-item" href="../../commons-operator/stable/index.html">Commons</a>
    <a class="drop-down-item" href="../../secret-operator/stable/index.html">Secret</a>
    </div>
</div>
<a class="navbar-sub-item" href="index.html">Contribute</a>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="home" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Stackable Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../quickstart.html">Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting_started.html">Getting Started</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tutorials/end-to-end_data_pipeline_example.html">Setting up an end-to-end data pipeline</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../operators/index.html">Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operators/supported_versions.html">Supported Product Versions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../operators/monitoring.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../airflow/stable/index.html">Apache Airflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../druid/stable/index.html">Apache Druid</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hbase/stable/index.html">Apache HBase</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hdfs/stable/index.html">Apache Hadoop HDFS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../hive/stable/index.html">Apache Hive</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../kafka/stable/index.html">Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../nifi/stable/index.html">Apache NiFi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../spark/stable/index.html">Apache Spark (standalone)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../spark-k8s/stable/index.html">Apache Spark on K8S</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../superset/stable/index.html">Apache Superset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../trino/stable/index.html">Trino</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../zookeeper/stable/index.html">Apache ZooKeeper</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../opa/stable/index.html">OpenPolicyAgent</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commons-operator/stable/index.html">Commons</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../secret-operator/stable/index.html">Secret</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Contributor&#8217;s Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="steps.html">Steps to contribute</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="development_dashboard.html">Development Dashboard</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="service_discovery.html">Service Discovery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="opa_configuration.html">OPA Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="style_guide.html">Documentation style guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="adr/index.html">Architectural Decision Records</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Current</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR001-choose_project_language.html">ADR001: Use English as Documentation Language</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR002-choose_repository_structure.html">ADR002: Use Multiple Repositories instead of one Large Repository</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR003-choose_review_mechanism.html">ADR003: Use RTC as Review Mechanism for Changes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR004-choose_agent_programming_language.html">ADR004: Use Rust as programming language for the agent</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR005-systemd_unit_file_location.html">ADR005: Decide on handling and location of systemd unit files</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR007-defined_reuse_of_k8s.html">ADR007: Decide if Kubernetes Components Are to be Reused for Stackable</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR008-decide_reuse_of_operators.html">ADR008: Allow Reuse of Existing Kubernetes Operators</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR009-selector_support.html">ADR009: Assigning Services to Nodes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR010-command_pattern.html">ADR010: Expressing one-shot commands in a Kubernetes-native way</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR011-directory_structure.html">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR012-authn_token_management.html">ADR012: Authentication token management</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR013-supported_kubernetes_versions.html">ADR013: Supported Kubernetes versions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR014-user_authentication_for_products.html">ADR014: User Authentication for Products</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR015-using_values_from_configmaps.html">ADR015: How Should Operators Use Values from ConfigMaps &amp; Secrets</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR016-definition_of_s3_objects.html">ADR016: Representation of S3 Buckets in CRDs</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR017-tls_authentication.html">ADR017: TLS authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR018-product_image_versioning.html">ADR018: Product Image Versioning</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR019-trino_catalog_definitions.html">ADR019: Trino catalog definitions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/ADR020-trino_catalog_usage.html">ADR020: Trino catalog usage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deprecated</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/deprecated/ADR006-choose_orchestrator_storage_backend.html">Use xxx as storage backend for the orchestrator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Drafts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="adr/drafts/ADRx-choose_authorization_engine.html">Choose Authorization Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../commons-operator/stable/index.html">Stackable Commons Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../commons-operator/stable/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../airflow/stable/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version">
          <a href="../../airflow/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../airflow/stable/index.html">0.3</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../druid/stable/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../druid/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hbase/stable/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hbase/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hdfs/stable/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hdfs/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hive/stable/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hive/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kafka/stable/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kafka/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nifi/stable/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nifi/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spark/stable/index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spark/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spark-k8s/stable/index.html">Stackable Operator for Apache Spark on Kubernetes</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spark-k8s/stable/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../superset/stable/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version">
          <a href="../../superset/nightly/index.html">nightly</a>
        </li>
        <li class="version is-latest">
          <a href="../../superset/stable/index.html">0.5</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../zookeeper/stable/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../zookeeper/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../opa/stable/index.html">Stackable Operator for OPA</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../opa/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../trino/stable/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../trino/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secret-operator/stable/index.html">Stackable Secret Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secret-operator/stable/index.html">nightly</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Stackable Documentation</a></li>
    <li><a href="index.html">Contributor&#8217;s Guide</a></li>
    <li><a href="service_discovery.html">Service Discovery</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/documentation/edit/main/modules/contributor/pages/service_discovery.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Service Discovery</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several products deployed by the Stackable platform depend on other (Stackable) products. This could be a product that requires an external database, high availability support or synchronization.</p>
</div>
<div class="paragraph">
<p>In order to programmatically resolve this dependency, the Stackable platform uses <em>service discovery</em>. A Stackable operator is aware of interfaces and connections that have to be exposed and may be consumed by other operators to configure their products. These interfaces or connections are usually referred to as <em>connection string</em>.</p>
</div>
<div class="paragraph">
<p>As a real world example, the Stackable Operator for Apache Kafka has to configure Kafka brokers with an Apache ZooKeeper connection string in order to store and share information about e.g. Kafka topics. This connection string is provided by the Stackable Operator for Apache ZooKeeper, which is aware of all the pods and services related to ZooKeeper.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples_for_connection_strings"><a class="anchor" href="#_examples_for_connection_strings"></a>Examples for connection strings</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>JDBC SQL connection strings: <code>jdbc:postgresql://localhost:12345</code></p>
</li>
<li>
<p>thrift protocol: <code>thrift://localhost:12345</code></p>
</li>
<li>
<p>spark protocol: <code>spark://master:7077</code></p>
</li>
<li>
<p>REST API: <code>http://localhost:8080</code></p>
</li>
<li>
<p>HDFS: <code>hdfs://localhost:12345</code></p>
</li>
<li>
<p>ZooKeeper ZNode: <code>host1:2181,host2:2181/my-chroot</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_concepts_of_service_discovery"><a class="anchor" href="#_concepts_of_service_discovery"></a>Concepts of Service Discovery</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_architecture"><a class="anchor" href="#_architecture"></a>Architecture</h3>
<div class="paragraph">
<p>The Operator that provides service discovery writes a <code>ConfigMap</code> with all necessary information about its exposed services. Each service has its own entry in the <code>ConfigMap</code> as can be seen with the <code>ZOOKEEPER</code> entry below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/service_discovery_arch.png" alt="Service Discovery">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_best_practices"><a class="anchor" href="#_best_practices"></a>Best practices</h3>
<div class="sect3">
<h4 id="_exposing_config_maps_for_service_discovery"><a class="anchor" href="#_exposing_config_maps_for_service_discovery"></a>Exposing config maps for service discovery</h4>
<div class="paragraph">
<p>The question about which interfaces to expose varies from product to product and must be decided on an individual basis. However, as far as possible the exposed services should be reachable via Kubernetes services like <code>ClusterIP</code> or <code>NodePort</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_consuming_config_maps_for_service_discovery"><a class="anchor" href="#_consuming_config_maps_for_service_discovery"></a>Consuming config maps for service discovery</h4>
<div class="paragraph">
<p>The operator that discovers a service has two options for retrieving the information and providing it into the pods:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mount the discovery <code>ConfigMap</code> into the <code>Pod</code> directly as an environment variable. This can be used for products supporting setting values via CLI or can work with environment variables in their respective configuration files.</p>
</li>
<li>
<p>Read the discovery <code>ConfigMap</code> and provide its content via the usual product configuration <code>ConfigMap</code>. This is in general a cleaner way if the product does not support setting values via CLI or environment variables in the configuration files because it avoids writing shell scripts to override the values manually.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_details"><a class="anchor" href="#_implementation_details"></a>Implementation details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following section offers some Rust code snippets to get an idea on how to create or retrieve the information in the discovery <code>ConfigMap</code>. As a convention, the name of that discovery <code>ConfigMap</code> is the name of the cluster. A deployed Stackable ZooKeeper cluster named <code>simple-zk</code> in namespace <code>production</code> will deploy a discovery <code>ConfigMap</code> <code>production/simple-zk</code>.</p>
</div>
<div class="sect2">
<h3 id="_create_a_discovery_configmap"><a class="anchor" href="#_create_a_discovery_configmap"></a>Create a discovery ConfigMap</h3>
<div class="paragraph">
<p>Remember, per convention the discovery <code>ConfigMap</code> name of a cluster must be equal to the cluster name. The following code demonstrates how to create a discovery <code>ConfigMap</code> using the <code>ConfigMapBuilder</code> of the <a href="https://github.com/stackabletech/operator-rs"><code>operator-rs</code></a> framework:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use stackable_operator::builder::{ConfigMapBuilder, ObjectMetaBuilder};

let cm = ConfigMapBuilder::new()
    .metadata(
        ObjectMetaBuilder::new()
            .name_and_namespace(my_cluster)
            .ownerreference_from_resource(my_cluster, None, Some(true))?
            .build()?,
    )
    .add_data("CONNECT_STRING", "http://localhost:12345")
    .build();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_consume_a_discovery_configmap"><a class="anchor" href="#_consume_a_discovery_configmap"></a>Consume a discovery ConfigMap</h3>
<div class="paragraph">
<p>Given a discovery <code>ConfigMap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: my-config-map-name
  namespace: production
data:
  CONNECT_STRING: "http://localhost:12345"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_mounting_the_discovery_configmap"><a class="anchor" href="#_mounting_the_discovery_configmap"></a>Mounting the discovery ConfigMap</h4>
<div class="paragraph">
<p>This is a method to retrieve an <code>EnvVar</code> from a <code>ConfigMap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use stackable_operator::k8s_openapi::api::{
    core::v1::{
       ConfigMapKeySelector, EnvVar, EnvVarSource,
    },
};

fn env_var_from_cm(name: &amp;str, configmap_name: &amp;str) -&gt; EnvVar {
    EnvVar {
        name: name.to_string(),
        value_from: Some(EnvVarSource {
            config_map_key_ref: Some(ConfigMapKeySelector {
                name: Some(configmap_name.to_string()),
                key: name.to_string(),
                ..ConfigMapKeySelector::default()
            }),
            ..EnvVarSource::default()
        }),
        ..EnvVar::default()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned <code>EnvVar</code> then can be added to a <code>Pod</code> container and used in the <code>command</code> or <code>args</code> field using the <a href="https://github.com/stackabletech/operator-rs"><code>operator-rs</code></a> framework container builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use stackable_operator::builder::ContainerBuilder;

let container = ContainerBuilder::new("my-container")
    .command(vec!["/bin/bash".to_string(), "-c".to_string()])
    .args(vec!["./do_magic", "--with-env-var", "${CONNECT_STRING}"])
    .add_env_var(env_var_from_cm("CONNECT_STRING", "my-config-map-name"))
    .build();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reading_the_discovery_configmap"><a class="anchor" href="#_reading_the_discovery_configmap"></a>Reading the discovery ConfigMap</h4>
<div class="paragraph">
<p>This is a method to read one entry of a discovery <code>ConfigMap</code> from an operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-rust hljs" data-lang="rust">use stackable_operator::{
    client::Client,
    error::OperatorResult,
    k8s_openapi::api::core::v1::ConfigMap,
};

async fn entry_from_cm(
    client: &amp;Client,
    name: &amp;str,
    namespace: Option&lt;&amp;str&gt;,
    entry: &amp;str,
) -&gt; OperatorResult&lt;String&gt; {
    Ok(client
        .get::&lt;ConfigMap&gt;(name, namespace)
        .await?
        .data
        .and_then(|mut data| data.remove(entry))
        .unwrap())
}

let connection_string = entry_from_cm(client, "my-config-map-name", Some("production"), "CONNECT_STRING").await?;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The retrieved connection string can be used to configure the product to connect to the discovered service.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_existing_libraries"><a class="anchor" href="#_existing_libraries"></a>Existing libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Currently, there is not much support from the <a href="https://github.com/stackabletech/operator-rs"><code>operator-rs</code></a> framework to assist with service discovery. The related code is mostly contained in each operator and similar to the examples above.</p>
</div>
<div class="paragraph">
<p>The following list should indicate support for certain products or helper methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConfigMapBuilder</code> in combination with <code>ObjectMetaBuilder</code> assists with building the discovery <code>ConfigMap</code></p>
</li>
<li>
<p><code>OPA</code>: The <a href="https://github.com/stackabletech/operator-rs"><code>operator-rs</code></a> framework has a module called <code>opa.rs</code> that supports the creation of the data API connection string</p>
</li>
</ul>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
