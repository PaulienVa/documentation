<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/spark/usage.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../_/css/site.css">
    <script>var uiRootPath = '../_'</script>
    <link rel="icon" href="../_/img/favicon.png" type="image/png">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://stackable.de"><img src="../_/img/stackable-logo.png"></a>
      <a class="navbar-item documentation-link" href="https://docs.stackable.tech">Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <a href="https://www.stackable.de/en/contact/" class="button pull-right">Contact Us</a>
    </div>
      <div id="topbar-nav" class="navbar-menu">
      </div>
      </div>
    </nav>
    <nav class="navbar-sub">
      <div class="container">
        <a class="navbar-sub-item" href="/home/index.html">Overview</a>
        <a class="navbar-sub-item" href="/home/index.html">Architecture</a>
        <a class="navbar-sub-item" href="/home/getting_started.html">Getting Started</a>
        <div class="navbar-sub-item drop-down">
          Operators
          <div class="drop-down-content">
            <a class="drop-down-item" href="/airflow/index.html">Apache Airflow</a>
            <a class="drop-down-item" href="/druid/index.html">Apache Druid</a>
            <a class="drop-down-item" href="/hbase/index.html">Apache HBase</a>
            <a class="drop-down-item" href="/hdfs/index.html">Apache Hadoop HDFS</a>
            <a class="drop-down-item" href="/hive/index.html">Apache Hive</a>
            <a class="drop-down-item" href="/kafka/index.html">Apache Kafka</a>
            <a class="drop-down-item" href="/nifi/index.html">Apache NiFi</a>
            <a class="drop-down-item" href="/spark/index.html">Apache Spark</a>
            <a class="drop-down-item" href="/superset/index.html">Apache Superset</a>
            <a class="drop-down-item" href="/trino/index.html">Trino</a>
            <a class="drop-down-item" href="/zookeeper/index.html">Apache ZooKeeper</a>
            <a class="drop-down-item" href="/opa/index.html">OpenPolicyAgent</a>
          </div>
        </div>

        <a class="arrow" href="javascript:document.querySelector('.navbar-sub').classList.toggle('open')">
          <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-right" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></svg>
        </a>
      </div>
    </nav>
  </header>
<div class="body">
    <div class="container">
<div class="nav-container" data-component="spark" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Stackable Operator for Apache Spark</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="installation.html">Installation</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Operator for Apache Spark</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../home/index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../home/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../airflow/index.html">Stackable Operator for Apache Airflow</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../airflow/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../druid/index.html">Stackable Operator for Apache Druid</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../druid/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hbase/index.html">Stackable Operator for Apache HBase</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hbase/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hdfs/index.html">Stackable Operator for Apache HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hdfs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../hive/index.html">Stackable Operator for Apache Hive</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../hive/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../kafka/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../kafka/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../nifi/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../nifi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../superset/index.html">Stackable Operator for Apache Superset</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../superset/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../zookeeper/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../zookeeper/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../opa/index.html">Stackable Operator for OpenPolicyAgent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../opa/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../trino/index.html">Stackable Operator for Trino</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../trino/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../home/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Stackable Operator for Apache Spark</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/spark-operator/edit/main/docs/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div class="sect1">
<h2 id="_create_an_apache_spark_cluster"><a class="anchor" href="#_create_an_apache_spark_cluster"></a>Create an Apache Spark cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you followed the installation instructions, you should now have a Stackable Operator for Apache Spark up and running and you are ready to create your first Apache Spark cluster.</p>
</div>
<div class="paragraph">
<p>The example below creates an Apache Spark 3.0.1 cluster with one master (because of <code>replicas: 1</code>), one history server and as many workers as nodes available.
Because of <code>enableMonitoring: true</code>, all pods will be annotated for metric scraping. Metrics are retrieved from Spark&#8217;s built in Prometheus Servlet.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: spark.stackable.tech/v1alpha1
kind: SparkCluster
metadata:
  name: simple-spark
spec:
  version: "3.0.1"
  config:
    enableMonitoring: true
  masters:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        replicas: 1
        config: {}
  workers:
    roleGroups:
      2core2g:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        config:
          cores: 2
          memory: "2g"
  historyServers:
    roleGroups:
      default:
        selector:
          matchLabels:
            kubernetes.io/os: linux
        replicas: 1
        config: {}
EOF</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_apache_spark_cluster"><a class="anchor" href="#_using_the_apache_spark_cluster"></a>Using the Apache Spark cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The example above sets up a <a href="https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport">NodePort</a> service named <code>simple-spark-master</code> that clients can use to run Spark jobs.</p>
</div>
<div class="paragraph">
<p>This is how the list of services might look like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>kubectl get svc
NAME                                  TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                         AGE
kubernetes                            ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP                         5h38m
simple-spark-history-server-default   ClusterIP   None           &lt;none&gt;        18080/TCP                       2m54s
simple-spark-master                   NodePort    10.96.63.134   &lt;none&gt;        8080:31296/TCP,7077:32274/TCP   2m54s
simple-spark-master-default           ClusterIP   None           &lt;none&gt;        8080/TCP,7077/TCP               2m54s
simple-spark-slave-2core2g            ClusterIP   None           &lt;none&gt;        8081/TCP                        2m54s</pre>
</div>
</div>
<div class="paragraph">
<p>To start a Spark shell from inside the cluster you would run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/stackable/spark/bin/spark-shell --master spark://simple-spark-master-default:7077</pre>
</div>
</div>
<div class="paragraph">
<p>and from outside:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>spark-shell --master spark://&lt;node-ip&gt;&gt;:32274</pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;node-ip&gt;</code> is the IP address of the node running your master.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring"><a class="anchor" href="#_monitoring"></a>Monitoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The managed Spark instances are automatically configured to export Prometheus metrics. See
<a href="../home/monitoring.html" class="xref page">Monitoring</a> for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_environment_overrides"><a class="anchor" href="#_configuration_environment_overrides"></a>Configuration &amp; Environment Overrides</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cluster definition also supports overriding configuration properties and environment variables, either per role or per role group, where the more specific override (role group) has precedence over the less specific one (role).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not override port numbers. This will lead to faulty installations.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_properties"><a class="anchor" href="#_configuration_properties"></a>Configuration Properties</h3>
<div class="paragraph">
<p>For a role or role group, at the same level of <code>config</code>, you can specify: <code>configOverrides</code> for the <code>spark-env.sh</code> and <code>spark-defaults.conf</code> files. For a list of possible configuration properties see: <a href="https://spark.apache.org/docs/latest/configuration.html" class="bare">https://spark.apache.org/docs/latest/configuration.html</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">masters:
  roleGroups:
    default:
      config: [...]
      configOverrides:
        spark-env.sh:
          JAVA_HOME=/some/other/java
        spark-defaults.conf:
          spark.driver.cores: "2"
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just as for the <code>config</code>, it is possible to specify this at role level as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">masters:
  configOverrides:
    spark-env.sh:
      JAVA_HOME=/some/other/java
    spark-defaults.conf:
      spark.driver.cores: "2"
  roleGroups:
    default:
      config: [...]
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>All override property values must be strings. The properties will be passed on without any escaping or formatting.</p>
</div>
</div>
<div class="sect2">
<h3 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a>Environment Variables</h3>
<div class="paragraph">
<p>Environment variables can be (over)written by adding them to <code>spark-env.sh</code> file as described above or by using the <code>envOverrides</code> property.</p>
</div>
<div class="paragraph">
<p>For example per role group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">routers:
  roleGroups:
    default:
      config: {}
      envOverrides:
        MY_ENV_VAR: "MY_VALUE"
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>or per role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">routers:
  envOverrides:
    MY_ENV_VAR: "MY_VALUE"
  roleGroups:
    default:
      config: {}
      replicas: 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here too, overriding properties such as <code>SPARK_MASTER_PORT</code> will lead to broken installations.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
    </div>
</div>
<footer class="footer">
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async src="../search-index.js"></script>
  </body>
</html>
