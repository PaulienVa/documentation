<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ADR011: Directory Structure Used by Stackable Components on Managed Hosts :: Stackable Documentation</title>
    <link rel="canonical" href="https://docs.stackable.tech/home/adr/ADR011-directory_structure.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.stackable.tech">Stackable Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="home" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Stackable Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../paths.html">Default Paths</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">ADRs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Current</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR001-choose_project_language.html">Use English as Documentation Language</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR002-choose_repository_structure.html">Use Multiple Repositories instead of one Large Repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR003-choose_review_mechanism.html">Use RTC as Review Mechanism for Changes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR004-choose_agent_programming_language.html">Use Rust as programming language for the agent</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR005-systemd_unit_file_location.html">Decide on handling and location of systemd unit files</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR007-defined_reuse_of_k8s.html">Decide if Kubernetes Components Are to be Reused for Stackable</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR008-decide_reuse_of_operators.html">Allow Reuse of Existing Kubernetes Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR009-selector_support.html">ADR009: Assigning Services to Nodes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ADR010-command_pattern.html">ADR010: Expressing one-shot commands in a Kubernetes-native way</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="ADR011-directory_structure.html">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Deprecated</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deprecated/ADR006-choose_orchestrator_storage_backend.html">Use xxx as storage backend for the orchestrator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Drafts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="drafts/ADRx-choose_authorization_engine.html">Choose Authorization Engine</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Maturity Levels</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/operators/operator_maturity_levels.html">Operator Maturity Levels</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/operators/apache_kafka.html">Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/operators/apache_nifi.html">Apache NiFi</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/operators/apache_spark.html">Apache Spark</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/operators/apache_zookeeper.html">Apache ZooKeeper</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Platform</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/platform_maturity_levels.html">Platform Maturity Levels</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/ML1.html">Maturity Level 1</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/ML2.html">Maturity Level 2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/ML3.html">Maturity Level 3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/ML4.html">Maturity Level 4</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../maturity_levels/platform/ML5.html">Maturity Level 5</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Stackable Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../agent/index.html">Stackable Agent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../agent/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Stackable Documentation</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hdfs/index.html">Stackable Operator for Apache Hadoop HDFS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hdfs/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kafka/index.html">Stackable Operator for Apache Kafka</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kafka/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nifi/index.html">Stackable Operator for Apache NiFi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nifi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../spark/index.html">Stackable Operator for Apache Spark</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../spark/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../zookeeper/index.html">Stackable Operator for Apache ZooKeeper</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../zookeeper/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../opa/index.html">Stackable Operator for OpenPolicyAgent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../opa/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../regorule/index.html">Stackable Operator for OpenPolicyAgent Rego rules</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../regorule/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Stackable Documentation</a></li>
    <li>ADRs</li>
    <li>Current</li>
    <li><a href="ADR011-directory_structure.html">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/stackabletech/documentation/edit/main/modules/adr/pages/ADR011-directory_structure.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">ADR011: Directory Structure Used by Stackable Components on Managed Hosts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Status: accepted</p>
</li>
<li>
<p>Deciders:</p>
<div class="ulist">
<ul>
<li>
<p>Sönke Liebau</p>
</li>
<li>
<p>Lars Francke</p>
</li>
</ul>
</div>
</li>
<li>
<p>Date:  17.03.2021</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_and_problem_statement"><a class="anchor" href="#_context_and_problem_statement"></a>Context and Problem Statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the Stackable platforms some components will need to be installed on the managed servers.
We will offer OS packages for a specified set of distributions, currently deb and RPM packages are available.
To make the components behave the same regardless of the target platform, we would like to agree on some default directories and what content we will put there.</p>
</div>
<div class="paragraph">
<p>This ADR is less to document alternative solutions, but rather to document the directory structure we agreed on, hence there are no alternative options discussed.
Instead, I have added excerpts from the <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html">Filesystem Hierarchy Standard</a> to illustrate why I think the chosen paths are the correct ones.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_considered_options"><a class="anchor" href="#_considered_options"></a>Considered Options</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Follow the <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html">Filesystem Hierarchy Standard</a> and keep files under <code>/etc/opt</code> and <code>/var/opt</code></p>
</li>
<li>
<p>Deviate from the Standard and remove the extra <code>opt</code> subdirectory</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision_drivers"><a class="anchor" href="#_decision_drivers"></a>Decision Drivers</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Predictability for users</p>
</li>
<li>
<p>Adherence to standards &amp; best-practices</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_decision"><a class="anchor" href="#_decision"></a>Decision</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We decided to deviate from what the <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html">Filesystem Hierarchy Standard</a> specifies, in order to make the file location more familiar to our users.
Please refer to the listing below for final locations.</p>
</div>
<div class="paragraph">
<p>While the standard calls for variable data and config files to be located in <code>opt</code> subdirectories under <code>/var</code> and <code>/etc</code> we have never seen this actually being done in practice and would expect our users to be confused if they had to look for the files here.</p>
</div>
<div class="sect2">
<h3 id="_benefits"><a class="anchor" href="#_benefits"></a>Benefits:</h3>
<div class="ulist">
<ul>
<li>
<p>Config files should be easily located for the largest part of our users</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_drawbacks"><a class="anchor" href="#_drawbacks"></a>Drawbacks:</h3>
<div class="ulist">
<ul>
<li>
<p>Strictly speaking we break the official requirements of where our config files should be - but we seem to be in good company, as no one really follows this recommendation anyway</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>/
├── etc
│   └── stackable
│       ├── agent
│       │   └── secure
│       ├── serviceconfig
│       └── zookeeper-operator
├── opt
│   └── stackable
│       ├── agent
│       ├── packages
│       └── zookeeper-operator
└── var
    ├── lib
    │   └── stackable
    │       └── agent
    └── log
        └── stackable
            └── servicelogs
                ├── namespace-product-name
                └── namespace-product-name</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_discussion_of_options"><a class="anchor" href="#_discussion_of_options"></a>Discussion of Options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_binaries_for_stackable_components"><a class="anchor" href="#_binaries_for_stackable_components"></a>Binaries for Stackable Components</h3>
<div class="paragraph">
<p>In accordance with <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html#optAddonApplicationSoftwarePackages">Filesystem Hierarchy Standard # 3.13.1</a> we will install the binaries for our components under `/opt/stackable/&lt;packagename&gt;/binaryfile.</p>
</div>
<div class="paragraph">
<p>In the example above there are subdirectories for the agent and the ZooKeeper operator which contain the executable files for these components.</p>
</div>
</div>
<div class="sect2">
<h3 id="_packages"><a class="anchor" href="#_packages"></a>Packages</h3>
<div class="paragraph">
<p>For worker servers which are under management by our agent, we will need to install packages that contain the upstream software that is being rolled out by the agent.
As this is also third party software but being used by Stackable we will install these under <code>/opt/stackable/' as well, but put them under a subdirectory `packages</code> to keep them separate from the Stackable software.</p>
</div>
<div class="paragraph">
<p>This only refers to the default setting the agent is configured with though, this path can be freely chosen by the user.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_files_for_stackable_components"><a class="anchor" href="#_configuration_files_for_stackable_components"></a>Configuration Files for Stackable Components</h3>
<div class="paragraph">
<p>According to <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html#etcoptConfigurationFilesForOpt">Filesystem Hierarchy Standard # 3.7.4</a>, if our binaries are kept under <code>/opt</code> we should keep the associated config files in <code>/etc/opt</code> and replicate the same folder structure here that can be found in <code>/opt</code>.</p>
</div>
<div class="paragraph">
<p>This default location seems like it is different from the industry standard, as we could not find any software that actually uses this path.
Instead it is accepted best-practice to put configuration either directly under <code>/etc</code> or create a vendor subdirectory under <code>/etc</code> and keep configs there.</p>
</div>
</div>
<div class="sect2">
<h3 id="_service_configuration"><a class="anchor" href="#_service_configuration"></a>Service Configuration</h3>
<div class="paragraph">
<p>According to the standard, config files that are written for the actual services that are managed by Stackable (Apache Kafka, Apache Hadoop, &#8230;&#8203;) should also reside in <code>/etc/opt/stackable</code>.</p>
</div>
<div class="paragraph">
<p>Following the logic stated above, we will divert from the standard and remove the <code>opt</code> from this path as well.</p>
</div>
<div class="paragraph">
<p>It doesn&#8217;t make sense to call the containing directory <code>packages</code>, like the parent directory for the binaries, so instead we have renamed it to <code>serviceconfig</code> to better express what it actually contains.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_directories"><a class="anchor" href="#_working_directories"></a>Working Directories</h3>
<div class="paragraph">
<p>For components that need working directories for variable / changing data on disk, the <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html#varoptVariableDataForOpt">standard</a> specifies that these should reside under <code>/var/opt/</code> and then again replicate the folder structure that exists under <code>/opt/</code>.</p>
</div>
<div class="paragraph">
<p>Like for config files we will deviate from the standard here and follow common practice instead.
Any component that needs a working directory should keep this in a subdirectory under <code>/var/lib/stackable/</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_log_file"><a class="anchor" href="#_log_file"></a>Log File</h3>
<div class="paragraph">
<p>Stackable components that have been installed from OS packages write their logs directly to the systemd journal.
These need not have a log directory on disk by default.</p>
</div>
<div class="paragraph">
<p>For the services that are managed by Stackable, log directories will be kept in per-service subdirectories under <code>/var/log/stackable/servicelogs</code>.
This can be configured in the agent and is just the default value.</p>
</div>
<div class="paragraph">
<p>The actual log directory for services that are rolled out on nodes managed by Stackable can be controlled by the user.
If users prefer to keep their logs in <code>/var/log/hadoop</code> for example then this can easily be overridden when creating the cluster.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
